server {
    listen {{ env "CONTAINER_PORT" }};

    root   /srv/www/dist/;
    add_header X-Backend-Server $hostname;
    add_header X-Project {{ env "PROJECT_NAME" }};

    {{if env "CI_BUILD_TAG"}}
        add_header Content-Security-Policy "script-src 'self' data:; object-src 'self' data:;frame-src 'self' https://ert-uat.nonprod.cloud-bss.loc/ https://service-portal-dmp-uat1.nonprod.cloud-bss.loc/ https://domain-resolver-frontend-dmp-uat1.nonprod.cloud-bss.loc/ http://service-portal-dmp-int1.nonprod.cloud-bss.loc http://service-portal-dmp-sit1.nonprod.cloud-bss.loc https://sso-balancer2.testing.srv.loc data:; frame-ancestors http://ert-int.nonprod.cloud-bss.loc/ http://service-portal-dmp-sit1.nonprod.cloud-bss.loc http://service-portal-dmp-sit1.nonprod.cloud-bss.loc https://sso-balancer2.testing.srv.loc https://service-portal-dmp-uat1.nonprod.cloud-bss.loc/ https://domain-resolver-frontend-dmp-uat1.nonprod.cloud-bss.loc/ https://ert-uat.nonprod.cloud-bss.loc/;";
    {{else}}
        add_header Content-Security-Policy "worker-src 'self' blob:; script-src 'self' data:; object-src 'self' data:;frame-src 'self' https://ert-uat.nonprod.cloud-bss.loc/ https://service-portal-dmp-uat1.nonprod.cloud-bss.loc/ https://domain-resolver-frontend-dmp-uat1.nonprod.cloud-bss.loc/ https://service-portal-dmp-int2.nonprod.cloud-bss.loc/ http://service-portal-dmp-sit1.nonprod.cloud-bss.loc http://service-portal-dmp-sit1.nonprod.cloud-bss.loc https://sso-balancer2.testing.srv.loc data:; frame-ancestors http://ert-sit1.nonprod.cloud-bss.loc/ http://service-portal-dmp-sit1.nonprod.cloud-bss.loc http://service-portal-dmp-sit1.nonprod.cloud-bss.loc https://sso-balancer2.testing.srv.loc https://ert-int2.nonprod.cloud-bss.loc https://service-portal-dmp-uat1.nonprod.cloud-bss.loc/ https://domain-resolver-frontend-dmp-uat1.nonprod.cloud-bss.loc/ https://ert-uat.nonprod.cloud-bss.loc/;";
    {{end}}

    index index.html;

    location /files/ {
         alias /static/files/;
    }

    location / {
        try_files $uri $uri/ /index.html;
        {{if env "CI_BUILD_TAG"}}
            expires 14d;
            add_header Cache-Control s-maxage=3600;
        {{end}}
    }
}
